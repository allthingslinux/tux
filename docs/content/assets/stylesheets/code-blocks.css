/**
 * Code Blocks & Syntax Highlighting
 * Styling for code blocks, syntax highlighting, and line numbers
 */

/* ============================================================
   Enhanced Code Blocks - Compact & Sleek
   ============================================================ */

.md-typeset pre {
    background: var(--color-code) !important;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: calc(var(--spacing) * 3);
    overflow-x: auto;
    position: relative;
    margin-top: calc(var(--spacing) * 3);
    margin-bottom: calc(var(--spacing) * 3);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.md-typeset pre code {
    background: transparent !important;
    color: var(--color-code-foreground) !important;
    padding: 0;
    border: none;
    font-size: 0.8rem;
    line-height: 1.5;
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
}

.md-typeset :not(pre)>code {
    background: var(--color-muted) !important;
    color: var(--color-primary) !important;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: 0.125rem 0.375rem;
    font-size: 0.8em;
    font-weight: 500;
}

.md-typeset .highlight {
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-border);
    overflow: hidden;
    background: var(--color-code);
    margin-top: calc(var(--spacing) * 3);
    margin-bottom: calc(var(--spacing) * 3);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.md-typeset .highlight .filename {
    background: var(--color-secondary-alpha-20);
    color: var(--color-muted-foreground);
    padding: calc(var(--spacing) * 1.5) calc(var(--spacing) * 3);
    font-size: 0.7rem;
    font-weight: 500;
    border-bottom: 1px solid var(--color-border);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 0;
    border-radius: var(--radius-sm) var(--radius-sm) 0 0;
}

/* Ensure headers are visible by default */
.md-typeset .highlight .filename {
    display: flex !important;
}

/* Hide language header for plain text blocks - more selective */
.md-typeset .highlight .filename:empty {
    display: none !important;
}

/* Only hide for specific plain text languages */
.md-typeset .highlight[data-lang="text"] .filename,
.md-typeset .highlight[data-lang="plain"] .filename,
.md-typeset .highlight[data-lang="txt"] .filename {
    display: none !important;
}

.md-typeset .highlight pre {
    margin: 0;
    border: none;
    border-radius: 0;
    padding: calc(var(--spacing) * 3);
}

/* ============================================================
   Line Number Styling - Natural Integration
   ============================================================ */

.md-typeset .highlight .linenodiv,
.md-typeset .codehilite .linenodiv {
    background: transparent !important;
    border-right: 1px solid var(--color-border);
    padding-right: calc(var(--spacing) * 2);
    margin-right: calc(var(--spacing) * 2);
}

.md-typeset .highlight .linenodiv pre,
.md-typeset .codehilite .linenodiv pre {
    background: transparent !important;
    color: var(--color-code-number);
    font-size: 0.8rem;
    line-height: 1.5;
    padding: calc(var(--spacing) * 3) calc(var(--spacing) * 2) calc(var(--spacing) * 3) calc(var(--spacing) * 3);
    margin: 0;
    border: none;
}

/* Inline line numbers - remove link styling from wrapper <a> tags */
.md-typeset .highlight a[href*="__codelineno"],
.md-typeset .codehilite a[href*="__codelineno"] {
    text-decoration: none;
    color: inherit;
    background: transparent;
    border: none;
    cursor: default;
}

.md-typeset .highlight a[href*="__codelineno"]:hover,
.md-typeset .codehilite a[href*="__codelineno"]:hover {
    text-decoration: none;
    background: transparent;
    color: inherit;
}

/* Override MkDocs Material's built-in line number styling */
.md-typeset .highlight [data-linenos]::before {
    background-color: transparent !important;
    box-shadow: none !important;
    position: static !important;
    float: none !important;
    left: auto !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    z-index: auto !important;
}

/* Inline line numbers (span.linenos with data-linenos attribute) */
.md-typeset .highlight span.linenos[data-linenos],
.md-typeset .codehilite span.linenos[data-linenos] {
    display: inline-block;
    background: transparent !important;
    border-right: 1px solid var(--color-border);
    padding-right: calc(var(--spacing) * 2.5);
    margin-right: calc(var(--spacing) * 2.5);
    color: var(--color-code-number);
    font-size: 0.8rem;
    text-align: right;
    min-width: 2.5em;
    user-select: none;
}

/* Display the line number from data-linenos attribute */
.md-typeset .highlight span.linenos[data-linenos]::before,
.md-typeset .codehilite span.linenos[data-linenos]::before {
    content: attr(data-linenos);
}

/* Table-based line numbers (for highlighttable layout) */
.md-typeset .highlight .linenos,
.md-typeset .codehilite .linenos {
    background: transparent !important;
    border-right: 1px solid var(--color-border);
    padding-right: calc(var(--spacing) * 2);
}

.md-typeset .highlight .linenos pre,
.md-typeset .codehilite .linenos pre {
    background: transparent !important;
    color: var(--color-code-number);
    font-size: 0.8rem;
    line-height: 1.5;
    padding: calc(var(--spacing) * 3) calc(var(--spacing) * 2) calc(var(--spacing) * 3) calc(var(--spacing) * 3);
    margin: 0;
    border: none;
}

.md-typeset .highlight .code,
.md-typeset .codehilite .code {
    background: var(--color-code) !important;
    padding: calc(var(--spacing) * 3);
}

.md-typeset .highlight .code pre,
.md-typeset .codehilite .code pre {
    background: transparent !important;
    margin: 0;
    padding: 0;
    border: none;
}

/* Additional styling for better line number integration */
.md-typeset .highlight table,
.md-typeset .codehilite table {
    background: var(--color-code) !important;
    border-collapse: collapse;
    width: 100%;
}

.md-typeset .highlight table td,
.md-typeset .codehilite table td {
    background: var(--color-code) !important;
    border: none;
    padding: 0;
    vertical-align: top;
}

.md-typeset .highlight table td.linenos,
.md-typeset .codehilite table td.linenos {
    background: transparent !important;
    border-right: 1px solid var(--color-border);
    padding-right: calc(var(--spacing) * 2);
    text-align: right;
    color: var(--color-code-number);
    font-size: 0.8rem;
    line-height: 1.5;
    padding: calc(var(--spacing) * 3) calc(var(--spacing) * 2) calc(var(--spacing) * 3) calc(var(--spacing) * 3);
}

.md-typeset .highlight table td.code,
.md-typeset .codehilite table td.code {
    background: var(--color-code) !important;
    padding: calc(var(--spacing) * 3);
    width: 100%;
}

/* ============================================================
   Superfences Specific Styling
   ============================================================ */

.md-typeset .superfences-tabs {
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-border);
    overflow: hidden;
    margin-top: calc(var(--spacing) * 3);
    margin-bottom: calc(var(--spacing) * 3);
}

.md-typeset .superfences-tabs .superfences-tab {
    background: var(--color-secondary-alpha-20);
    color: var(--color-muted-foreground);
    padding: calc(var(--spacing) * 1.5) calc(var(--spacing) * 3);
    font-size: 0.7rem;
    font-weight: 500;
    border-bottom: 1px solid var(--color-border);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.15s ease;
    margin: 0;
    border-radius: var(--radius-sm) var(--radius-sm) 0 0;
}

.md-typeset .superfences-tabs .superfences-tab:hover {
    background: var(--color-secondary-alpha-30);
}

.md-typeset .superfences-tabs .superfences-tab.active {
    background: var(--color-code);
    color: var(--color-foreground);
    border-bottom-color: var(--color-primary);
}

.md-typeset .superfences-tabs .superfences-content {
    background: var(--color-code);
}

.md-typeset .superfences-tabs .superfences-content pre {
    margin: 0;
    border: none;
    border-radius: 0;
    padding: calc(var(--spacing) * 3);
}

/* Hide superfences tabs for plain text only */
.md-typeset .superfences-tabs[data-lang="text"] .superfences-tab,
.md-typeset .superfences-tabs[data-lang="plain"] .superfences-tab,
.md-typeset .superfences-tabs[data-lang="txt"] .superfences-tab {
    display: none;
}

/* Additional superfences styling for code blocks with headers */
.md-typeset .codehilite .filename,
.md-typeset .codehilite .code-header {
    background: var(--color-secondary-alpha-20);
    color: var(--color-muted-foreground);
    padding: calc(var(--spacing) * 1.5) calc(var(--spacing) * 3);
    font-size: 0.7rem;
    font-weight: 500;
    border-bottom: 1px solid var(--color-border);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 0;
    border-radius: var(--radius-sm) var(--radius-sm) 0 0;
}

/* Hide codehilite headers for plain text */
.md-typeset .codehilite[data-lang="text"] .filename,
.md-typeset .codehilite[data-lang="plain"] .filename,
.md-typeset .codehilite[data-lang="txt"] .filename,
.md-typeset .codehilite[data-lang="text"] .code-header,
.md-typeset .codehilite[data-lang="plain"] .code-header,
.md-typeset .codehilite[data-lang="txt"] .code-header {
    display: none;
}

/* Copy button styling */
.md-typeset .highlight .filename .copy,
.md-typeset .codehilite .filename .copy,
.md-typeset .codehilite .code-header .copy {
    opacity: 0.6;
    transition: opacity 0.15s ease;
    cursor: pointer;
}

.md-typeset .highlight .filename .copy:hover,
.md-typeset .codehilite .filename .copy:hover,
.md-typeset .codehilite .code-header .copy:hover {
    opacity: 1;
}

/* ============================================================
   Syntax Highlighting Classes (from mkdocs-material)
   ============================================================ */

.highlight {

    /* Operator and Operator word */
    :is(.o, .ow) {
        color: var(--md-code-hl-operator-color);
    }

    /* Punctuation */
    .p {
        color: var(--md-code-hl-punctuation-color);
    }

    /* String literals */
    :is(.cpf, .l, .s, .sb, .sc, .s2, .si, .s1, .ss) {
        color: var(--md-code-hl-string-color);
    }

    /* Special strings */
    :is(.cp, .se, .sh, .sr, .sx) {
        color: var(--md-code-hl-special-color);
    }

    /* Numbers */
    :is(.m, .mb, .mf, .mh, .mi, .il, .mo) {
        color: var(--md-code-hl-number-color);
    }

    /* Keywords */
    :is(.k, .kd, .kn, .kp, .kr, .kt) {
        color: var(--md-code-hl-keyword-color);
    }

    /* Name constants */
    :is(.kc, .n) {
        color: var(--md-code-hl-name-color);
    }

    /* Built-in constants */
    :is(.no, .nb, .bp) {
        color: var(--md-code-hl-constant-color);
    }

    /* Functions and classes */
    :is(.nc, .ne, .nf, .nn) {
        color: var(--md-code-hl-function-color);
    }

    /* Decorators and tags */
    :is(.nd, .ni, .nl, .nt) {
        color: var(--md-code-hl-keyword-color);
    }

    /* Comments */
    :is(.c, .cm, .c1, .ch, .cs, .sd) {
        color: var(--md-code-hl-comment-color);
    }

    /* Variables */
    :is(.na, .nv, .vc, .vg, .vi) {
        color: var(--md-code-hl-variable-color);
    }

    /* Generic elements */
    :is(.ge, .gr, .gh, .go, .gp, .gs, .gu, .gt) {
        color: var(--md-code-hl-generic-color);
    }

    /* Diff highlighting */
    :is(.gd, .gi) {
        padding: 0 0.125rem;
        margin: 0 -0.125rem;
        border-radius: var(--radius-sm);
    }

    .gd {
        /* Diff delete */
        background-color: var(--md-typeset-del-color);
    }

    .gi {
        /* Diff insert */
        background-color: var(--md-typeset-ins-color);
    }

    /* Highlighted lines */
    .hll {
        display: block;
        padding: 0 1rem;
        margin: 0 -1rem;
        background-color: var(--md-code-hl-color--light);
        box-shadow: 2px 0 0 0 var(--md-code-hl-color) inset;
    }

    /* Code block title */
    span.filename {
        position: relative;
        display: flow-root;
        padding: 0.5625rem 1rem;
        margin-top: 1em;
        font-size: 0.85rem;
        font-weight: 700;
        background-color: var(--md-code-bg-color);
        border-bottom: 1px solid var(--md-default-fg-color--lightest);
        border-top-left-radius: var(--radius-sm);
        border-top-right-radius: var(--radius-sm);
    }

    span.filename+pre {
        margin-top: 0;
    }

    span.filename+pre>code {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

    /* Line numbers (pymdownx-inline) - removed, handled by span.linenos styling above */

    /* Line anchors */
    code a[id] {
        position: absolute;
        visibility: hidden;
    }

    /* Copying in progress */
    code[data-md-copying] {
        display: initial;
    }

    code[data-md-copying] .hll {
        display: contents;
    }

    code[data-md-copying] .md-annotation {
        display: none;
    }
}

/* ============================================================
   Code Block Layout (highlighttable)
   ============================================================ */

.highlighttable {
    display: flow-root;
}

.highlighttable :is(tbody, td) {
    display: block;
    padding: 0;
}

.highlighttable tr {
    display: flex;
}

.highlighttable pre {
    margin: 0;
}

.highlighttable th.filename {
    flex-grow: 1;
    padding: 0;
    text-align: left;
}

.highlighttable th.filename span.filename {
    margin-top: 0;
}

.highlighttable .linenos {
    padding: 0.65625rem 1rem;
    padding-right: 0;
    font-size: 0.85rem;
    user-select: none;
    background-color: var(--md-code-bg-color);
    border-top-left-radius: var(--radius-sm);
    border-bottom-left-radius: var(--radius-sm);
}

.highlighttable .linenodiv {
    padding-right: 0.5rem;
    box-shadow: -1px 0 var(--md-default-fg-color--lightest) inset;
}

.highlighttable .linenodiv pre {
    color: var(--md-default-fg-color--light);
    text-align: right;
}

.highlighttable .code {
    flex: 1;
    min-width: 0;
}

.linenodiv a {
    color: inherit;
}

/* ============================================================
   Code Block Results
   ============================================================ */

.highlight+.result {
    padding: 0 1rem;
    margin-top: calc(-1em + -0.125rem);
    overflow: visible;
    border: 1px solid var(--md-code-bg-color);
    border-top-width: 2px;
    border-bottom-right-radius: var(--radius-sm);
    border-bottom-left-radius: var(--radius-sm);
}

.highlight+.result::after {
    display: block;
    clear: both;
    content: "";
}
