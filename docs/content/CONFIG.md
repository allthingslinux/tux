# Tux Configuration Guide

This document provides comprehensive configuration information for the Tux Discord bot. All configuration options are automatically generated from the Pydantic BaseSettings classes using [settings-doc](https://github.com/radeklat/settings-doc).

## Table of Contents

- [Overview](#overview)
- [Quick Start](#quick-start)
- [Environment Variables](#environment-variables)
- [Configuration Options](#configuration-options)
- [Environment-Specific Settings](#environment-specific-settings)
- [Advanced Configuration](#advanced-configuration)
- [Development Tools](#development-tools)

## Overview

Tux uses a comprehensive configuration system based on Pydantic BaseSettings. This provides:

- **Type Safety**: All configuration values are validated at runtime
- **Environment Variable Binding**: Automatic loading from `.env` files and environment variables
- **Nested Configuration**: Support for complex, hierarchical configuration objects
- **Auto-Documentation**: This file is automatically generated from the actual settings code
- **Validation**: Built-in validation for all configuration values

## Quick Start

1. **Copy the example configuration:**
   ```bash
   cp env.example .env
   ```

2. **Edit the `.env` file** with your specific values:
   ```bash
   # Edit .env with your bot tokens and database URLs
   nano .env
   ```

3. **Start the bot** (it will auto-detect your environment):
   ```bash
   make start
   ```

## Environment Variables

The bot uses simplified configuration that works the same everywhere:

- **All environments**: Use direct variables like `BOT_TOKEN` and `DATABASE_URL`
- **No prefixes needed**: Just set your values directly
- **Consistent behavior**: Same functionality whether running locally or in Docker

### Priority Order (highest to lowest):
1. Environment variables (runtime override)
2. `.env` file (local development)
3. Pydantic model defaults (fallback)

## Configuration Options

<!-- CONFIGURATION START -->
# `DEBUG`

*Optional*, default value: `False`

Enable debug mode

# `BOT_TOKEN`

*Optional*, default value: ``

Discord bot token

# `POSTGRES_HOST`

*Optional*, default value: `localhost`

PostgreSQL host

# `POSTGRES_PORT`

*Optional*, default value: `5432`

PostgreSQL port

# `POSTGRES_DB`

*Optional*, default value: `tuxdb`

PostgreSQL database name

# `POSTGRES_USER`

*Optional*, default value: `tuxuser`

PostgreSQL username

# `POSTGRES_PASSWORD`

*Optional*, default value: `tuxpass`

PostgreSQL password

# `DATABASE_URL`

*Optional*, default value: ``

Custom database URL override

# `BOT_INFO__BOT_NAME`

*Optional*, default value: `Tux`

Name of the bot

# `BOT_INFO__BOT_VERSION`

*Optional*, default value: `0.0.0`

Bot version

# `BOT_INFO__ACTIVITIES`

*Optional*, default value: `[]`

Bot activities

# `BOT_INFO__HIDE_BOT_OWNER`

*Optional*, default value: `False`

Hide bot owner info

# `BOT_INFO__PREFIX`

*Optional*, default value: `~`

Command prefix

# `USER_IDS__BOT_OWNER_ID`

*Optional*, default value: `0`

Bot owner user ID

# `USER_IDS__SYSADMINS`

*Optional*

System admin user IDs

# `ALLOW_SYSADMINS_EVAL`

*Optional*, default value: `False`

Allow sysadmins to use eval

# `STATUS_ROLES__MAPPINGS`

*Optional*

Status to role mappings

# `TEMPVC__TEMPVC_CHANNEL_ID`

*Optional*, default value: `None`

Temporary VC channel ID

# `TEMPVC__TEMPVC_CATEGORY_ID`

*Optional*, default value: `None`

Temporary VC category ID

# `GIF_LIMITER__RECENT_GIF_AGE`

*Optional*, default value: `60`

Recent GIF age limit

# `GIF_LIMITER__GIF_LIMITS_USER`

*Optional*

User GIF limits

# `GIF_LIMITER__GIF_LIMITS_CHANNEL`

*Optional*

Channel GIF limits

# `GIF_LIMITER__GIF_LIMIT_EXCLUDE`

*Optional*

Excluded channels

# `XP_CONFIG__XP_BLACKLIST_CHANNELS`

*Optional*

XP blacklist channels

# `XP_CONFIG__XP_ROLES`

*Optional*

XP roles

# `XP_CONFIG__XP_MULTIPLIERS`

*Optional*

XP multipliers

# `XP_CONFIG__XP_COOLDOWN`

*Optional*, default value: `1`

XP cooldown in seconds

# `XP_CONFIG__LEVELS_EXPONENT`

*Optional*, default value: `2`

Levels exponent

# `XP_CONFIG__SHOW_XP_PROGRESS`

*Optional*, default value: `True`

Show XP progress

# `XP_CONFIG__ENABLE_XP_CAP`

*Optional*, default value: `False`

Enable XP cap

# `SNIPPETS__LIMIT_TO_ROLE_IDS`

*Optional*, default value: `False`

Limit snippets to specific roles

# `SNIPPETS__ACCESS_ROLE_IDS`

*Optional*

Snippet access role IDs

# `IRC_CONFIG__BRIDGE_WEBHOOK_IDS`

*Optional*

IRC bridge webhook IDs

# `EXTERNAL_SERVICES__SENTRY_DSN`

*Optional*, default value: ``

Sentry DSN

# `EXTERNAL_SERVICES__GITHUB_APP_ID`

*Optional*, default value: ``

GitHub app ID

# `EXTERNAL_SERVICES__GITHUB_INSTALLATION_ID`

*Optional*, default value: ``

GitHub installation ID

# `EXTERNAL_SERVICES__GITHUB_PRIVATE_KEY`

*Optional*, default value: ``

GitHub private key

# `EXTERNAL_SERVICES__GITHUB_CLIENT_ID`

*Optional*, default value: ``

GitHub client ID

# `EXTERNAL_SERVICES__GITHUB_CLIENT_SECRET`

*Optional*, default value: ``

GitHub client secret

# `EXTERNAL_SERVICES__GITHUB_REPO_URL`

*Optional*, default value: ``

GitHub repository URL

# `EXTERNAL_SERVICES__GITHUB_REPO_OWNER`

*Optional*, default value: ``

GitHub repository owner

# `EXTERNAL_SERVICES__GITHUB_REPO`

*Optional*, default value: ``

GitHub repository name

# `EXTERNAL_SERVICES__MAILCOW_API_KEY`

*Optional*, default value: ``

Mailcow API key

# `EXTERNAL_SERVICES__MAILCOW_API_URL`

*Optional*, default value: ``

Mailcow API URL

# `EXTERNAL_SERVICES__WOLFRAM_APP_ID`

*Optional*, default value: ``

Wolfram Alpha app ID

# `EXTERNAL_SERVICES__INFLUXDB_TOKEN`

*Optional*, default value: ``

InfluxDB token

# `EXTERNAL_SERVICES__INFLUXDB_URL`

*Optional*, default value: ``

InfluxDB URL

# `EXTERNAL_SERVICES__INFLUXDB_ORG`

*Optional*, default value: ``

InfluxDB organization
<!-- CONFIGURATION END -->

## Configuration

### Simple Setup
- **File**: `.env` (copy from `env.example`)
- **Variables**: Just set `BOT_TOKEN` and `DATABASE_URL`
- **Database**: Any PostgreSQL database (local or remote)
- **Debug**: Automatically enabled in development contexts

## Advanced Configuration

### Nested Configuration Objects

Tux uses nested Pydantic models for organized configuration:

```python
# Example: Bot information configuration
BOT_INFO__BOT_NAME=Tux
BOT_INFO__PREFIX=~
BOT_INFO__BOT_VERSION=0.0.0
```

### Custom Validation

The configuration system includes custom validation for:
- Database URL formats
- Bot token validation
- Environment-specific requirements
- Nested object validation

### Consistent Behavior

The bot behaves identically everywhere:
- **Local development**: Same functionality as Docker
- **Docker deployment**: Same functionality as local
- **Testing**: Same core functionality with test detection

## Development Tools

### Generate Documentation

```bash
# Generate configuration documentation
make docs-config

# Generate .env template
make docs-env

# Update this CONFIG.md file
make docs-config-markdown

# Update README with configuration docs
make docs-config-update
```

### Pre-commit Integration

Configuration documentation is automatically kept up-to-date through pre-commit hooks. The hooks will:

- Update `CONFIG.md` with latest settings
- Update `env.example` with latest template
- Ensure documentation stays synchronized with code

### Manual Updates

If you need to manually regenerate documentation:

```bash
# Using settings-doc directly
uv run settings-doc generate --module tux.shared.config.settings --output-format markdown

# Generate .env template
uv run settings-doc generate --module tux.shared.config.settings --output-format dotenv
```

## File Locations

- **Settings Code**: `src/tux/shared/config/settings.py`
- **Configuration Models**: `src/tux/shared/config/models.py`
- **Environment Detection**: `src/tux/shared/config/environment.py`
- **Example Configuration**: `env.example`
- **Your Configuration**: `.env` (create from env.example)

## Troubleshooting

### Common Issues

1. **Module Import Errors**: Ensure you're running commands from the project root
2. **Missing Dependencies**: Run `uv sync` to install all dependencies
3. **Configuration Validation**: Check the error messages for specific validation failures
4. **Environment Detection**: Verify your `.env` file has the correct `ENV` setting

### Getting Help

- Check the [DEVELOPER.md](DEVELOPER.md) for development setup
- Review the [SETUP.md](SETUP.md) for installation instructions
- Join our [Discord server](https://discord.gg/linux) for support

---

> **ðŸ’¡ Tip**: This documentation is automatically generated from your Pydantic settings classes. When you add new configuration options, they'll automatically appear here after running `make docs-config-markdown`.
