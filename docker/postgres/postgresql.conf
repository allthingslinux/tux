# =============================================================================
# TUX POSTGRESQL CONFIGURATION
# =============================================================================
# Optimized PostgreSQL configuration for Tux Discord bot
# Based on professional XMPP server configurations
# =============================================================================

# =============================================================================
# CONNECTION AND AUTHENTICATION
# =============================================================================
listen_addresses = '*'    # Listen on all interfaces for Docker networking
# Production: use 'localhost' or specific IP
# Development: use Docker network range for container access
max_connections = 100                    # Maximum concurrent connections
superuser_reserved_connections = 3       # Reserved for superuser

# =============================================================================
# MEMORY CONFIGURATION
# =============================================================================
# Shared buffers: 25% of RAM for dedicated database server
shared_buffers = 256MB                   # Increased from default 128MB

# Effective cache size: 75% of RAM
effective_cache_size = 768MB             # Optimized for 1GB+ systems

# Work memory: For complex queries and sorting
work_mem = 16MB                          # Increased from default 4MB

# Maintenance work memory: For VACUUM, ANALYZE, CREATE INDEX
maintenance_work_mem = 128MB             # Increased from default 64MB

# =============================================================================
# WRITE-AHEAD LOG (WAL) CONFIGURATION
# =============================================================================
# Checkpoint completion target: Spread checkpoints over time
checkpoint_completion_target = 0.9       # Default: 0.9 (good)

# WAL buffers: For transaction logs
wal_buffers = 16MB                       # Increased from default 4MB

# WAL file size
max_wal_size = 1GB                       # Default: 1GB
min_wal_size = 80MB                      # Default: 80MB

# =============================================================================
# QUERY PLANNER CONFIGURATION
# =============================================================================
# Statistics target: More accurate query planning
default_statistics_target = 100          # Default: 100 (good)

# Random page cost: Optimized for SSD storage
random_page_cost = 1.1                   # Default: 4.0 (HDD), 1.1 (SSD)

# Effective I/O concurrency: Parallel I/O operations
effective_io_concurrency = 200           # Default: 1, 200 for SSD

# =============================================================================
# AUTOVACUUM CONFIGURATION
# =============================================================================
# Enable autovacuum for automatic maintenance
autovacuum = on                          # Default: on

# Autovacuum thresholds
autovacuum_vacuum_threshold = 50         # Default: 50
autovacuum_analyze_threshold = 50        # Default: 50

# Autovacuum scale factors
autovacuum_vacuum_scale_factor = 0.2     # Default: 0.2
autovacuum_analyze_scale_factor = 0.1    # Default: 0.1

# Autovacuum work memory
autovacuum_work_mem = 64MB               # Default: -1 (uses maintenance_work_mem)

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
# Log level
log_min_messages = warning               # Default: warning

# Log statements
log_min_duration_statement = 1000        # Log queries taking >1 second

# Log connections and disconnections
log_connections = on                     # Default: off
log_disconnections = on                  # Default: off

# Log autovacuum activity
log_autovacuum_min_duration = 0         # Log all autovacuum activity

# =============================================================================
# PERFORMANCE MONITORING
# =============================================================================
# Enable statistics collection
track_activities = on                    # Default: on
track_counts = on                        # Default: on
track_io_timing = on                     # Default: off (requires track_activities)

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
# SSL configuration (disabled for development - no SSL settings at all)
# ssl = off                                # Disable SSL for development
# ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL' # Strong cipher suite (when SSL enabled)

# Connection security
tcp_keepalives_idle = 600               # TCP keepalive idle time
tcp_keepalives_interval = 30            # TCP keepalive interval
tcp_keepalives_count = 3                # TCP keepalive count

# =============================================================================
# LOCALE AND ENCODING
# =============================================================================
# Character encoding
client_encoding = 'UTF8'                 # Default: UTF8

# Timezone
timezone = 'UTC'                         # Default: GMT

# Locale
lc_messages = 'C'                        # Default: C
lc_monetary = 'C'                        # Default: C
lc_numeric = 'C'                         # Default: C
lc_time = 'C'                            # Default: C

# =============================================================================
# DEVELOPMENT OPTIMIZATIONS
# =============================================================================
# Enable debug logging in development
log_statement = 'all'                    # Log all statements (development only)
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# =============================================================================
# TUX-SPECIFIC OPTIMIZATIONS
# =============================================================================
# Optimize for Discord bot workload
# - High read/write ratio
# - Frequent small transactions
# - Moderate connection count

# Connection pooling hints
max_prepared_transactions = 0            # Disable prepared statements for bot usage

# Query optimization
enable_seqscan = on                      # Allow sequential scans for small tables
enable_indexscan = on                    # Enable index scans
enable_bitmapscan = on                   # Enable bitmap scans
enable_hashjoin = on                     # Enable hash joins
enable_mergejoin = on                    # Enable merge joins
enable_nestloop = on                     # Enable nested loop joins

# =============================================================================
# END OF CONFIGURATION
# =============================================================================
