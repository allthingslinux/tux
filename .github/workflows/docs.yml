---
# ==============================================================================
# DOCUMENTATION BUILD WORKFLOW
# ==============================================================================
# Builds and validates MkDocs documentation.
#
# Deployment is handled automatically by Cloudflare Workers Builds using the
# wrangler.toml configuration in docs/wrangler.toml
#
# To set up Cloudflare Workers deployment:
# 1. Connect your repository to Workers Builds in Cloudflare dashboard
# 2. Point to docs/wrangler.toml as the configuration file
# 3. Workers will automatically deploy on push to main/release branches
# 4. Preview deployments created automatically for PRs
#
# Manual deployment: cd docs && wrangler deploy
# ==============================================================================
name: Docs
on:
  push:
    branches: [main, 'v[0-9]+.[0-9]+.[0-9]+*']
    paths: [docs/**, docs/mkdocs.yml, .github/workflows/docs.yml]
  pull_request:
    branches: [main, 'v[0-9]+.[0-9]+*']
    paths: [docs/**, docs/mkdocs.yml, .github/workflows/docs.yml]
  workflow_dispatch:
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ github.event_name == 'pull_request' }}
env:
  PYTHON_VERSION: 3.13.8
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup Python
        uses: ./.github/actions/setup-python
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          enable-cache: true
      - name: Install Documentation Dependencies
        run: |
          # Install docs dependency group
          uv sync --group docs --no-dev
      - name: Build Documentation
        run: |
          cd docs
          uv run mkdocs build --strict --verbose
          echo "âœ… Documentation built successfully"
      - name: Check Links
        continue-on-error: true
        run: |
          # Install link checker
          npm install -g markdown-link-check
          # Check all markdown files for broken links
          find docs -name "*.md" -exec markdown-link-check {} \; || echo "âš ï¸ Some links may be broken"
      - name: Summary
        run: |-
          {
            echo "## ðŸ“š Documentation Build"
            echo "**Status**: âœ… Build successful"
            echo "**Branch**: ${{ github.ref_name }}"
            echo "**Commit**: ${{ github.sha }}"
            echo ""
            echo "Deployment will be handled automatically by Cloudflare Workers Builds"
          } >> "$GITHUB_STEP_SUMMARY"
